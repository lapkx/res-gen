<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Resume Genius - Create & Match</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    .resume-paper { background: linear-gradient(to bottom, #f9f9f9, #ffffff); box-shadow: 0 4px 30px rgba(0,0,0,0.1); border-top: 8px solid #3b82f6; }
    .progress-step.active { background-color: #3b82f6; color: white; }
    .job-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    .skill-level { height: 6px; border-radius: 3px; background-color: #e5e7eb; }
    .skill-level-fill { height: 100%; border-radius: 3px; background-color: #3b82f6; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <header class="text-center mb-10">
      <h1 class="text-4xl font-bold text-blue-600 mb-2">Resume Genius</h1>
      <p class="text-gray-600">Create a professional resume in minutes, then find jobs that match your profile</p>
    </header>

    <!-- Progress Steps -->
    <div class="flex justify-center mb-12">
      <div class="flex items-center">
        <div id="step1" class="progress-step active w-10 h-10 rounded-full border-2 border-blue-500 text-blue-500 font-bold flex items-center justify-center">1</div>
        <div class="w-16 h-1 bg-blue-500 mx-2"></div>
        <div id="step2" class="progress-step w-10 h-10 rounded-full border-2 border-gray-300 text-gray-400 font-bold flex items-center justify-center">2</div>
        <div class="w-16 h-1 bg-gray-300 mx-2"></div>
        <div id="step3" class="progress-step w-10 h-10 rounded-full border-2 border-gray-300 text-gray-400 font-bold flex items-center justify-center">3</div>
      </div>
    </div>

    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Form Section (STEP 1) -->
      <div class="w-full lg:w-1/2 bg-white rounded-xl shadow-md p-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Your Information</h2>
        <form id="resumeForm" class="space-y-6">
          <!-- [YOUR EXISTING FORM FIELDS GO HERE: Personal, Summary, Experience, Education, Skills] -->
          <!-- ... -->
          <div class="pt-4">
            <button id="generateResume" type="button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg">
              Generate Professional Resume
            </button>
          </div>
        </form>
      </div>

      <!-- Preview & Filters (STEP 2) -->
      <div id="previewSection" class="w-full lg:w-1/2 hidden space-y-6">
        <!-- AI Resume Output -->
        <div id="aiResult" class="bg-white resume-paper rounded-xl p-8 whitespace-pre-wrap text-gray-800"></div>

        <!-- Filter Panel -->
        <div id="filterSection" class="bg-white p-6 rounded-lg shadow hidden">
          <h3 class="text-xl font-semibold mb-4">Refine Job Search</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Search Keywords</label>
              <input id="filterKeywords" type="text" class="w-full px-4 py-2 border rounded-lg" placeholder="e.g. Frontend Developer" />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Location</label>
              <input id="filterLocation" type="text" class="w-full px-4 py-2 border rounded-lg" placeholder="e.g. Remote, Austin, TX" />
            </div>
            <fieldset class="grid grid-cols-2 gap-4">
              <legend class="text-sm font-medium text-gray-700">Job Type</legend>
              <label class="inline-flex items-center"><input id="fullTime" type="checkbox" class="form-checkbox" /><span class="ml-2">Full Time</span></label>
              <label class="inline-flex items-center"><input id="partTime" type="checkbox" class="form-checkbox" /><span class="ml-2">Part Time</span></label>
              <label class="inline-flex items-center"><input id="contract" type="checkbox" class="form-checkbox" /><span class="ml-2">Contract</span></label>
              <label class="inline-flex items-center"><input id="permanent" type="checkbox" class="form-checkbox" /><span class="ml-2">Permanent</span></label>
            </fieldset>
            <div class="mt-4">
              <button id="applyFiltersBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg">
                Apply Filters & Search
              </button>
            </div>
          </div>
        </div>

        <!-- Job Results (STEP 3) -->
        <div id="jobResultsSection" class="hidden">
          <h3 class="text-2xl font-bold mb-4">Matching Jobs</h3>
          <div id="jobResults" class="space-y-4"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Collect form data
    function collectFormData() {
      const form = document.getElementById('resumeForm');
      const [name, email, phone, location] = Array.from(form.querySelectorAll('input[placeholder]')).slice(0,4).map(i=>i.value.trim());
      const summary = form.querySelector('textarea').value.trim();
      // ...collect experiences, education, skills as before...
      return { name, email, phone, location, summary, experiences: [], education: [], skills: [] };
    }

    // Step 1: Generate Resume
    document.getElementById('generateResume').onclick = async () => {
      const btn = document.getElementById('generateResume');
      btn.disabled = true; btn.textContent = 'Polishing…';
      document.getElementById('filterSection').classList.add('hidden');
      document.getElementById('jobResultsSection').classList.add('hidden');

      try {
        const payload = collectFormData();
        const res = await fetch('/api/generate', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload) });
        const { result } = await res.json();
        // split reasoning/final as before...
        document.getElementById('aiResult').innerHTML = `<details class="mb-4"><summary class="cursor-pointer font-medium text-blue-600">Show AI Full Output</summary><pre class="whitespace-pre-wrap mt-2 bg-gray-100 p-4 rounded">${result}</pre></details>`;
        document.getElementById('previewSection').classList.remove('hidden');
        document.getElementById('step1').classList.remove('active');
        document.getElementById('step2').classList.add('active');
        document.getElementById('filterSection').classList.remove('hidden');
      } finally {
        btn.disabled = false; btn.textContent = 'Generate Professional Resume';
      }
    };

    // Step 2: Apply Filters & Search
    document.getElementById('applyFiltersBtn').onclick = async () => {
      const btn = document.getElementById('applyFiltersBtn');
      btn.disabled = true; btn.textContent = 'Filtering…';
      const keywords = document.getElementById('filterKeywords').value.trim();
      const loc      = document.getElementById('filterLocation').value.trim();
      const types    = [];
      if (document.getElementById('fullTime').checked)  types.push('full_time');
      if (document.getElementById('partTime').checked)  types.push('part_time');
      if (document.getElementById('contract').checked)  types.push('contract');
      if (document.getElementById('permanent').checked) types.push('permanent');

      try {
        const { skills, location } = collectFormData();
        const body = { skills, location: loc||location, filters:{ keywords, types } };
        const res = await fetch('/api/adzuna', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body) });
        const { jobs } = await res.json();
        const container = document.getElementById('jobResults');
        container.innerHTML = '';
        if (!jobs.length) {
          container.innerHTML = '<p class="text-gray-600">No matching jobs found.</p>';
        } else {
          jobs.forEach(job => {
            const card = document.createElement('div');
            card.className = 'p-4 border rounded-lg hover:shadow-lg transition';
            card.innerHTML = `
              <h3 class="text-xl font-bold">${job.title}</h3>
              <p class="text-gray-600">${job.company} • ${job.location}</p>
              <p class="mt-2 text-gray-700">${job.description.slice(0,150)}…</p>
              <a href="${job.url}" target="_blank" class="inline-block mt-3 text-blue-600 hover:underline">View & Apply</a>
            `;
            container.appendChild(card);
          });
        }
        document.getElementById('step2').classList.remove('active');
        document.getElementById('step3').classList.add('active');
        document.getElementById('jobResultsSection').classList.remove('hidden');
      } catch (e) {
        console.error(e);
      } finally {
        btn.disabled = false; btn.textContent = 'Apply Filters & Search';
      }
    };
  </script>
</body>
</html>
